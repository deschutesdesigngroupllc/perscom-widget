{"version":3,"file":"widget.js","mappings":"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","sources":["webpack://perscom-3.0-widget/./widget.js"],"sourcesContent":["/**\n * PERSCOM Widget\n *\n * @author Jon Erickson\n * @description A JavaScript widget for embedding PERSCOM functionality into web pages.\n */\n\nconst apiUrl = process.env.API_URL || 'https://api.perscom-app.test/v2/widgets/';\n\nconst IFRAME_ID = 'perscom_widget_iframe';\nconst WRAPPER_ID = 'perscom_widget_wrapper';\n\n/**\n * PERSCOM Widget\n */\nclass Widget {\n  /**\n   * Initialize the widget\n   *\n   * @param widget\n   * @param apiKey\n   */\n  init = (widget = 'roster', apiKey = null) => {\n    this.widget = widget;\n    this.apiKey = apiKey;\n\n    this.initializeIframe().then(() => {\n      this.mountIframe();\n      this.setupIframeResizer();\n      this.setupNavigationListener();\n    });\n  };\n\n  /**\n   * Sets up the library to auto resize the iframe\n   * and injects into the client page.\n   */\n  setupIframeResizer = () => {\n    if (document.getElementById(IFRAME_ID)) {\n      const iframeResizerScript = document.createElement('script');\n      iframeResizerScript.src = 'https://cdn.jsdelivr.net/npm/@iframe-resizer/parent@5.3.2';\n      iframeResizerScript.type = 'text/javascript';\n      iframeResizerScript.onload = () => {\n        window.iframeResize({ log: false, license: 'GPLv3', waitForLoad: true }, `#${IFRAME_ID}`);\n      };\n\n      document.body.appendChild(iframeResizerScript);\n    }\n  };\n\n  /**\n   * Construct the iframe\n   */\n  initializeIframe = async () => {\n    if (!document.getElementById(IFRAME_ID) && document.getElementById(WRAPPER_ID)) {\n      try {\n        const url = apiUrl + this.widget;\n        const response = await fetch(apiUrl + this.widget, {\n          headers: {\n            Accept: 'text/html',\n            Authorization: `Bearer ${this.apiKey}`\n          }\n        });\n\n        let html;\n        if (\n          response.status >= 500 ||\n          response.headers.get('content-type')?.includes('application/json')\n        ) {\n          const json = await response.json();\n          html = `<script src=\"https://cdn.tailwindcss.com\"></script><div class=\"text-sm\"><div class=\"font-bold\">${json.error.message}</div><ul class=\"mt-2 list-inside\"><li><span class=\"font-semibold\">URL:</span> ${url}</li><li><span class=\"font-semibold\">Request ID:</span> ${json.error.request_id}</li><li><span class=\"font-semibold\">Trace ID:</span> ${json.error.trace_id}</li></ul></div>`;\n        } else {\n          html = await response.text();\n        }\n\n        const blob = new Blob([html], { type: 'text/html' });\n        const blobUrl = URL.createObjectURL(blob);\n\n        const iframe = document.createElement('iframe');\n        iframe.src = blobUrl;\n        iframe.id = IFRAME_ID;\n        iframe.crossorigin = 'anonymous';\n        iframe.style.width = '1px';\n        iframe.style.minWidth = '100%';\n        iframe.style.background = 'transparent';\n        iframe.style.position = 'relative';\n        iframe.style.margin = 0;\n        iframe.style.border = 'none';\n        iframe.style.overflow = 'hidden';\n        iframe.style.display = 'block';\n        iframe.style.outline = 'none';\n        iframe.style.boxShadow = 'none';\n        iframe.style.filter = 'none';\n\n        this.iframe = iframe;\n      } catch (err) {\n        console.error('Failed to initialize PERSCOM widget:', err);\n      }\n    }\n  };\n\n  /**\n   * Mount the iframe\n   */\n  mountIframe = () => {\n    if (!document.getElementById(IFRAME_ID) && document.getElementById(WRAPPER_ID)) {\n      const wrapper = document.getElementById(WRAPPER_ID);\n      wrapper.appendChild(this.iframe);\n    }\n  };\n\n  setupNavigationListener = () => {\n    window.addEventListener('message', (event) => {\n      if (event.data?.type === 'widget:navigate') {\n        console.log(event.data)\n      }\n    });\n  };\n\n  navigate = async (path) => {\n    try {\n      const response = await fetch(apiUrl + path, {\n        headers: {\n          Accept: 'text/html',\n          Authorization: `Bearer ${this.apiKey}`,\n        }\n      });\n\n      let html = await response.text();\n\n      const blob = new Blob([html], { type: 'text/html' });\n      const blobUrl = URL.createObjectURL(blob);\n\n      if (this.iframe) {\n        this.iframe.src = blobUrl;\n      }\n    } catch (err) {\n      console.error('Navigation failed:', err);\n    }\n  };\n}\n\n/**\n * Initialize widget class\n */\n(() => {\n  const scriptTag = document.getElementById('perscom_widget');\n\n  if (!scriptTag) {\n    console.error(\n      'PERSCOM widget script tag not found. Please include a script tag with id \"perscom_widget\" in your HTML.'\n    );\n    return;\n  }\n\n  const widget = scriptTag.getAttribute('data-widget');\n  const apiKey = scriptTag.getAttribute('data-apikey');\n\n  console.log({\n    widget: widget,\n    apiKey: apiKey\n  });\n\n  window.perscom = new Widget();\n  window.perscom.init(widget, apiKey);\n})();\n"],"names":["apiUrl","process","API_URL","IFRAME_ID","WRAPPER_ID","Widget","init","_this","widget","arguments","length","undefined","apiKey","initializeIframe","then","mountIframe","setupIframeResizer","setupNavigationListener","document","getElementById","iframeResizerScript","createElement","src","type","onload","window","iframeResize","log","license","waitForLoad","body","appendChild","async","url","this","response","fetch","headers","Accept","Authorization","html","status","get","includes","json","error","message","request_id","trace_id","text","blob","Blob","blobUrl","URL","createObjectURL","iframe","id","crossorigin","style","width","minWidth","background","position","margin","border","overflow","display","outline","boxShadow","filter","err","addEventListener","event","data","navigate","path","scriptTag","getAttribute","perscom"],"sourceRoot":""}