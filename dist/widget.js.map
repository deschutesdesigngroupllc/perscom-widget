{"version":3,"file":"widget.js","mappings":"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","sources":["webpack://perscom-3.0-widget/./widget.js"],"sourcesContent":["/**\n * PERSCOM Widget\n *\n * @author Jon Erickson\n * @description A JavaScript widget for embedding PERSCOM functionality into web pages.\n */\n\nconst apiUrl = process.env.API_URL || 'https://api.perscom-app.test/v2/widgets/';\n\nconst SCRIPT_ID = 'perscom_widget';\nconst IFRAME_ID = 'perscom_widget_iframe';\nconst WRAPPER_ID = 'perscom_widget_wrapper';\n\n/**\n * PERSCOM Widget\n */\nclass Widget {\n  /**\n   * Initialize the widget\n   *\n   * @param widget\n   * @param apiKey\n   * @param resource\n   * @param dark\n   */\n  init = (widget = 'roster', apiKey = null, resource = null, dark = false) => {\n    this.widget = widget;\n    this.apiKey = apiKey;\n    this.resource = resource;\n    this.dark = dark;\n\n    this.initializeIframe().then(() => {\n      this.mountIframe();\n      this.setupIframeResizer();\n      this.setupNavigationListener();\n    });\n  };\n\n  /**\n   * Sets up the library to auto resize the iframe\n   * and injects into the client page.\n   */\n  setupIframeResizer = () => {\n    if (document.getElementById(IFRAME_ID)) {\n      const iframeResizerScript = document.createElement('script');\n      iframeResizerScript.src = 'https://cdn.jsdelivr.net/npm/@iframe-resizer/parent@5.3.2';\n      iframeResizerScript.type = 'text/javascript';\n      iframeResizerScript.onload = () => {\n        window.iframeResize({ log: false, license: 'GPLv3', waitForLoad: true }, `#${IFRAME_ID}`);\n      };\n\n      document.body.appendChild(iframeResizerScript);\n    }\n  };\n\n  /**\n   * Construct the iframe\n   */\n  initializeIframe = async () => {\n    if (!document.getElementById(IFRAME_ID) && document.getElementById(WRAPPER_ID)) {\n      try {\n        const iframe = document.createElement('iframe');\n        iframe.id = IFRAME_ID;\n        iframe.crossorigin = 'anonymous';\n        iframe.style.width = '1px';\n        iframe.style.minWidth = '100%';\n        iframe.style.background = 'transparent';\n        iframe.style.position = 'relative';\n        iframe.style.margin = 0;\n        iframe.style.border = 'none';\n        iframe.style.overflow = 'hidden';\n        iframe.style.display = 'block';\n        iframe.style.outline = 'none';\n        iframe.style.boxShadow = 'none';\n        iframe.style.filter = 'none';\n        iframe.setAttribute(\n          'sandbox',\n          'allow-scripts allow-forms allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-top-navigation allow-top-navigation-by-user-activation allow-modals'\n        );\n\n        this.iframe = iframe;\n        this.navigate(this.widget);\n      } catch (err) {\n        console.error('Failed to initialize PERSCOM widget:', err);\n      }\n    }\n  };\n\n  /**\n   * Mount the iframe\n   */\n  mountIframe = () => {\n    if (!document.getElementById(IFRAME_ID) && document.getElementById(WRAPPER_ID)) {\n      const wrapper = document.getElementById(WRAPPER_ID);\n      wrapper.appendChild(this.iframe);\n    }\n  };\n\n  /**\n   * Register an event listener for changing the iframe src\n   */\n  setupNavigationListener = () => {\n    window.addEventListener('message', (event) => {\n      if (event.data?.type === 'widget:navigate' && event.data?.path) {\n        console.debug('Received widget navigate event', event);\n        this.navigate(event.data.path);\n      }\n    });\n  };\n\n  /**\n   * Update the iframe src to a new URL\n   *\n   * @param path\n   */\n  navigate = (path) => {\n    const url = new URL(apiUrl + path);\n    url.searchParams.append('apikey', this.apiKey);\n\n    if (this.dark) {\n      url.searchParams.append('dark', 'true');\n    }\n\n    if (this.iframe) {\n      this.iframe.src = url.toString();\n    }\n  };\n}\n\n/**\n * Initialize widget class\n */\n(() => {\n  const scriptTag = document.getElementById(SCRIPT_ID);\n  const wrapperTag = document.getElementById(WRAPPER_ID);\n\n  if (!scriptTag) {\n    console.error(\n      'PERSCOM widget script tag not found. Please include a script tag with ID \"perscom_widget\" in your HTML. Documentation and examples available at https://docs.perscom.io.'\n    );\n    return;\n  }\n\n  if (!wrapperTag) {\n    console.error(\n      'PERSCOM widget wrapper tag not found. Please make sure to wrap your \"perscom_widget\" script inside a div with ID \"perscom_widget_wrapper\". Documentation and examples available at https://docs.perscom.io.'\n    );\n    return;\n  }\n\n  const widget = scriptTag.getAttribute('data-widget');\n  const apiKey = scriptTag.getAttribute('data-apikey');\n  const resource = scriptTag.getAttribute('data-resource');\n  const dark = scriptTag.getAttribute('data-dark') === 'true';\n\n  console.log({\n    widget: widget,\n    apiKey: apiKey\n  });\n\n  window.perscom = new Widget();\n  window.perscom.init(widget, apiKey, resource, dark);\n})();\n"],"names":["apiUrl","process","API_URL","IFRAME_ID","WRAPPER_ID","Widget","init","_this","widget","arguments","length","undefined","apiKey","resource","dark","initializeIframe","then","mountIframe","setupIframeResizer","setupNavigationListener","document","getElementById","iframeResizerScript","createElement","src","type","onload","window","iframeResize","log","license","waitForLoad","body","appendChild","async","iframe","id","crossorigin","style","width","minWidth","background","position","margin","border","overflow","display","outline","boxShadow","filter","setAttribute","this","navigate","err","addEventListener","event","data","path","url","URL","searchParams","append","toString","scriptTag","wrapperTag","getAttribute","perscom"],"sourceRoot":""}